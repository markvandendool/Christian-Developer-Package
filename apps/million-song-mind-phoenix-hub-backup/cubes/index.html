<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<base href="/">
	<title>ChordCubes 6.0 V1.50 RESTORED FROM REAL V1.49 BACKUP</title>
	<link rel="stylesheet" href="./styles.css?v=2" />
	<style>
		@font-face {
			font-family: 'NVXDiamond';
			src:
				url('./fonts/NVX Diamond Font.otf') format('opentype'),
				url('./fonts/NVX%20Diamond%20Font.otf') format('opentype');
			font-weight: 400;
			font-style: normal;
			font-display: swap;
		}

		@font-face {
			font-family: 'FontJan16';
			src: url('./fonts/Font Jan16.otf') format('opentype');
			font-weight: normal;
			font-style: normal;
			font-display: swap;
		}

		/* FONT JAN16 LIGATURE ENABLEMENT - Novaxe's Masterful System */
		.font-jan16-ligatures {
			font-family: 'FontJan16', 'Cochin', 'Times New Roman', serif;
			font-feature-settings: "liga" 1, "kern" 1, "calt" 1;
			font-variant-ligatures: common-ligatures discretionary-ligatures;
			text-rendering: optimizeLegibility;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

		/* Apply ligature features globally to ensure Font Jan16 b→l transformation works */
		* {
			font-feature-settings: "liga" 1, "kern" 1;
			font-variant-ligatures: common-ligatures;
			text-rendering: optimizeLegibility;
		}

		/* GIANT 2.0 Version Display */
		.version-header {
			position: absolute;
			top: 10px;
			left: 50%;
			transform: translateX(-50%);
			z-index: 1000;
			text-align: center;
		}

		.main-title {
			font-family: 'NVXDiamond', Arial, sans-serif;
			font-size: 2.5rem;
			font-weight: bold;
			color: #ffffff;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
			margin: 0;
			position: relative;
		}

		.version-badge {
			font-family: 'NVXDiamond', Arial, sans-serif;
			font-size: 4rem;
			font-weight: 900;
			color: #00d4ff;
			text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9);
			position: absolute;
			top: -10px;
			right: -120px;
			transform: rotate(-15deg);
			opacity: 0.9;
		}

		/* PROFESSIONAL DRUM MACHINE STYLES */
		#drum-control-panel {
			position: fixed !important;
			top: 20px !important;
			transform: none !important;
			right: 20px !important;
			width: 400px !important;
			background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 20, 0.9)) !important;
			backdrop-filter: blur(10px);
			border: 2px solid #00ff00 !important;
			border-radius: 20px !important;
			padding: 30px !important;
			resize: both !important;
			overflow: auto !important;
			cursor: move !important;
			z-index: 2147483647 !important;
			box-shadow:
				0 0 50px rgba(0, 255, 0, 0.5),
				0 10px 40px rgba(0, 0, 0, 0.8),
				inset 0 0 30px rgba(0, 255, 0, 0.1) !important;
			transform: translateZ(9999px) !important;
			pointer-events: auto !important;
			animation: glow 3s ease-in-out infinite;
		}

		@keyframes glow {

			0%,
			100% {
				box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), 0 10px 40px rgba(0, 0, 0, 0.8);
			}

			50% {
				box-shadow: 0 0 50px rgba(0, 255, 0, 0.8), 0 10px 40px rgba(0, 0, 0, 0.8);
			}
		}

		.panel-header {
			display: flex;
			align-items: center;
			margin-bottom: 25px;
			padding-bottom: 20px;
			border-bottom: 2px solid rgba(0, 255, 0, 0.3);
		}

		.panel-title {
			color: #00ff00;
			font-size: 28px;
			font-weight: bold;
			margin: 0;
			text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
			flex: 1;
		}

		.status-indicator {
			width: 12px;
			height: 12px;
			border-radius: 50%;
			background: #ff0000;
			box-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
			animation: pulse-red 2s infinite;
		}

		.status-indicator.active {
			background: #00ff00;
			animation: pulse-green 2s infinite;
		}

		@keyframes pulse-red {

			0%,
			100% {
				box-shadow: 0 0 5px rgba(255, 0, 0, 0.8);
			}

			50% {
				box-shadow: 0 0 20px rgba(255, 0, 0, 1);
			}
		}

		@keyframes pulse-green {

			0%,
			100% {
				box-shadow: 0 0 5px rgba(0, 255, 0, 0.8);
			}

			50% {
				box-shadow: 0 0 20px rgba(0, 255, 0, 1);
			}
		}

		/* BPM CONTROL */
		.control-group {
			margin-bottom: 25px;
		}

		.control-label {
			color: #00ff00;
			font-size: 14px;
			text-transform: uppercase;
			letter-spacing: 2px;
			margin-bottom: 10px;
			display: block;
			opacity: 0.9;
		}

		.bpm-control {
			display: flex;
			align-items: center;
			gap: 15px;
		}

		.bpm-slider {
			flex: 1;
			-webkit-appearance: none;
			height: 8px;
			border-radius: 5px;
			background: rgba(0, 255, 0, 0.2);
			outline: none;
		}

		.bpm-slider::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 24px;
			height: 24px;
			border-radius: 50%;
			background: #00ff00;
			cursor: pointer;
			box-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
			transition: all 0.3s;
		}

		.bpm-slider::-webkit-slider-thumb:hover {
			transform: scale(1.2);
			box-shadow: 0 0 25px rgba(0, 255, 0, 1);
		}

		.bpm-display {
			min-width: 60px;
			text-align: center;
			font-size: 24px;
			font-weight: bold;
			color: #00ff00;
			text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
		}

		/* GENRE SELECTOR */
		.genre-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
			margin-bottom: 25px;
		}

		.genre-btn {
			padding: 12px;
			background: linear-gradient(135deg, rgba(0, 100, 0, 0.3), rgba(0, 50, 0, 0.2));
			border: 1px solid rgba(0, 255, 0, 0.3);
			border-radius: 10px;
			color: rgba(0, 255, 0, 0.7);
			font-size: 12px;
			cursor: pointer;
			transition: all 0.3s;
			text-transform: uppercase;
			font-weight: bold;
			letter-spacing: 1px;
		}

		.genre-btn:hover {
			background: linear-gradient(135deg, rgba(0, 150, 0, 0.4), rgba(0, 100, 0, 0.3));
			border-color: rgba(0, 255, 0, 0.6);
			color: #00ff00;
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
		}

		.genre-btn.active {
			background: linear-gradient(135deg, #00ff00, #00cc00);
			border-color: #00ff00;
			color: #000;
			box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
		}

		/* MAIN CONTROLS */
		.main-controls {
			display: flex;
			gap: 15px;
			margin-bottom: 25px;
		}

		.control-btn {
			flex: 1;
			padding: 20px;
			font-size: 18px;
			font-weight: bold;
			text-transform: uppercase;
			border: 2px solid;
			border-radius: 12px;
			cursor: pointer;
			transition: all 0.3s;
			letter-spacing: 2px;
		}

		.play-btn {
			background: linear-gradient(135deg, #ff0000, #cc0000);
			border-color: #ff6666;
			color: white;
		}

		.play-btn.playing {
			background: linear-gradient(135deg, #00ff00, #00cc00);
			border-color: #66ff66;
			color: #000;
			animation: pulse-play 1s infinite;
		}

		@keyframes pulse-play {

			0%,
			100% {
				transform: scale(1);
			}

			50% {
				transform: scale(1.05);
			}
		}

		.metronome-btn {
			background: linear-gradient(135deg, #0066ff, #0044cc);
			border-color: #6699ff;
			color: white;
		}

		.metronome-btn.active {
			background: linear-gradient(135deg, #ff6600, #cc4400);
			border-color: #ff9966;
		}

		/* PATTERN SEQUENCER */
		.sequencer {
			background: rgba(0, 0, 0, 0.5);
			border-radius: 10px;
			padding: 15px;
			margin-bottom: 20px;
		}

		.sequencer-row {
			display: flex;
			gap: 5px;
			margin-bottom: 8px;
		}

		.sequencer-label {
			width: 60px;
			color: rgba(0, 255, 0, 0.7);
			font-size: 12px;
			text-align: right;
			padding-right: 10px;
			line-height: 30px;
		}

		.sequencer-steps {
			display: flex;
			gap: 4px;
			flex: 1;
		}

		.step {
			flex: 1;
			height: 30px;
			background: rgba(0, 255, 0, 0.1);
			border: 1px solid rgba(0, 255, 0, 0.2);
			border-radius: 4px;
			cursor: pointer;
			transition: all 0.2s;
		}

		.step:hover {
			background: rgba(0, 255, 0, 0.2);
			border-color: rgba(0, 255, 0, 0.4);
		}

		.step.active {
			background: #00ff00;
			border-color: #00ff00;
			box-shadow: 0 0 10px rgba(0, 255, 0, 0.6);
		}

		.step.playing {
			background: #ffff00 !important;
			border-color: #ffff00 !important;
			box-shadow: 0 0 15px rgba(255, 255, 0, 0.8) !important;
		}

		/* STATUS DISPLAY */
		.status-display {
			background: rgba(0, 0, 0, 0.7);
			border: 1px solid rgba(0, 255, 0, 0.2);
			border-radius: 8px;
			padding: 12px;
			font-size: 11px;
			color: rgba(0, 255, 0, 0.8);
			font-family: 'Courier New', monospace;
			line-height: 1.4;
		}

		.status-line {
			display: flex;
			justify-content: space-between;
			margin-bottom: 4px;
		}

		.status-label {
			opacity: 0.7;
		}

		.status-value {
			color: #00ff00;
			font-weight: bold;
		}
	</style>

	<!-- 🧙‍♂️ ULTRA-OPTIMIZED DEBUG WIDGET CSS -->
	<style>
		.debug-panel {
			position: fixed;
			bottom: 120px;
			/* Above any existing HUD */
			right: 20px;
			background: rgba(0, 0, 0, 0.9);
			border: 2px solid #00ff00;
			border-radius: 10px;
			padding: 15px;
			font-family: 'Courier New', monospace;
			color: #00ff00;
			z-index: 10000;
			min-width: 200px;
			backdrop-filter: blur(5px);
			box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
		}

		.debug-title {
			font-size: 12px;
			font-weight: bold;
			text-align: center;
			margin-bottom: 10px;
			color: #ffff00;
		}

		.debug-keyboard {
			margin-bottom: 15px;
		}

		.debug-row {
			display: flex;
			gap: 8px;
			margin-bottom: 5px;
			justify-content: center;
		}

		.debug-key {
			display: inline-block;
			padding: 4px 8px;
			background: #333;
			border: 1px solid #666;
			border-radius: 3px;
			font-size: 10px;
			min-width: 20px;
			text-align: center;
			transition: all 0.1s ease;
		}

		.debug-key.active {
			background: #00ff00;
			color: #000;
			box-shadow: 0 0 10px #00ff00;
			transform: scale(1.1);
		}

		.debug-cube-container {
			display: flex;
			flex-direction: column;
			align-items: center;
			margin-bottom: 10px;
		}

		.debug-cube-label {
			font-size: 10px;
			margin-top: 5px;
			color: #ffff00;
		}

		#debug-cube-face {
			border: 1px solid #00ff00;
			border-radius: 5px;
			background: #111;
		}

		.debug-status {
			font-size: 9px;
			text-align: center;
			color: #888;
			border-top: 1px solid #333;
			padding-top: 8px;
		}

		.debug-status.active {
			color: #00ff00;
			font-weight: bold;
		}
	</style>
	<script src="https://unpkg.com/soundfont-player@0.15.7/dist/soundfont-player.js"></script>
</head>

<body>


	<div id="ui">
		<div class="row">
			<label>Key</label>
			<select id="key-select">
				<option value="C" selected>C</option>
				<option value="Db">Db</option>
				<option value="D">D</option>
				<option value="Eb">Eb</option>
				<option value="E">E</option>
				<option value="F">F</option>
				<option value="F#">F#</option>
				<option value="G">G</option>
				<option value="Ab">Ab</option>
				<option value="A">A</option>
				<option value="Bb">Bb</option>
				<option value="B">B</option>
			</select>
			<label>Sets</label>
			<label style="margin-left: 8px;"><input type="checkbox" id="set-major" checked> Major</label>
			<label style="margin-left: 8px;"><input type="checkbox" id="set-minor" checked> Minor</label>
			<label style="margin-left: 8px;"><input type="checkbox" id="set-applied" checked> Applied</label>
			<label>Label</label>
			<select id="label-mode">
				<option value="roman" selected>Roman</option>
				<option value="letter">Letter</option>
			</select>
			<button id="arrange-btn">Arrange</button>
			<button id="reset-btn">Reset</button>
			<label style="margin-left:12px;">
				<input type="checkbox" id="adjust-toggle" /> Adjust shelf
			</label>
			<button id="save-map-btn" title="Download shelf_map.json">Save Map</button>
			<label class="file-btn">
				Load Map
				<input type="file" id="load-map-input" accept="application/json" hidden />
			</label>
			<label style="margin-left:12px;">
				<input type="checkbox" id="with-7th" /> With 7th
			</label>
			<!-- CLEAN ALIGNED INSTRUMENT LAYOUT -->
			<div
				style="display: inline-flex; align-items: flex-start; margin-left: 12px; gap: 20px; vertical-align: top; margin-top: 24px;">
				<div style="display: flex; flex-direction: column; align-items: flex-start;">
					<label style="margin-bottom: 2px; font-size: 12px;">Bass Instrument</label>
					<select id="bass-inst" style="width: 120px; margin-bottom: 6px;">
						<option value="contrabass" selected>Contrabass</option>
						<option value="acoustic_bass">Acoustic Bass</option>
						<option value="electric_bass_finger">Electric Bass</option>
						<option value="electric_bass_pick">Electric Bass (Pick)</option>
						<option value="cello">Cello</option>
						<option value="viola">Viola</option>
						<option value="synth_bass_1">Synth Bass 1</option>
						<option value="synth_bass_2">Synth Bass 2</option>
						<option value="trombone">Trombone</option>
						<option value="french_horn">French Horn</option>
						<option value="bassoon">Bassoon</option>
						<option value="acoustic_guitar_nylon">Nylon Guitar</option>
						<option value="acoustic_guitar_steel">Steel Guitar</option>
					</select>
					<label style="margin-bottom: 2px; font-size: 12px;">Bass Volume</label>
					<div style="display: flex; align-items: center; margin-bottom: 6px;">
						<span style="font-size: 14px; margin-right: 4px; cursor: pointer;" id="bass-mute"
							title="Mute">🔇</span>
						<input type="range" id="bass-volume" min="0" max="1.15" step="0.05" value="0.5"
							style="width:100px;">
						<span style="font-size: 14px; margin-left: 4px; cursor: pointer;" id="bass-boost"
							title="Boost +15%">🔊</span>
					</div>
					<button id="lock-bass"
						style="width:120px; padding:4px; background:#333; color:#fff; border:1px solid #555; border-radius:4px; cursor:pointer;">Lock
						Bass</button>
					<button id="play-bass"
						style="width:120px; padding:4px; margin-top:4px; background:#333; color:#fff; border:1px solid #555; border-radius:4px; cursor:pointer;">▶
						Play Bassline</button>
				</div>

				<!-- Chord Column (Center) -->
				<div style="display: flex; flex-direction: column; align-items: flex-start;">
					<label style="margin-bottom: 2px; font-size: 12px;">Chord Instrument</label>
					<select id="chord-inst" style="width: 120px; margin-bottom: 6px;">
						<optgroup label="🎹 Keyboards">
							<option value="acoustic_grand_piano" selected>Piano</option>
							<option value="electric_piano_1">Electric Piano 1</option>
							<option value="electric_piano_2">Electric Piano 2</option>
							<option value="harpsichord">Harpsichord</option>
						</optgroup>
						<optgroup label="🎺 Organs">
							<option value="church_organ">Church Organ</option>
							<option value="jazz_organ">Jazz Organ</option>
						</optgroup>
						<optgroup label="🎻 Strings">
							<option value="string_ensemble_1">Strings (Ensemble)</option>
							<option value="string_ensemble_2">Strings 2</option>
							<option value="pizzicato_strings">Pizzicato Strings</option>
						</optgroup>
						<optgroup label="👥 Voices">
							<option value="choir_aahs">Choir</option>
							<option value="voice_oohs">Voice Oohs</option>
							<option value="synth_voice">Synth Voice</option>
						</optgroup>
						<optgroup label="🎸 Other">
							<option value="accordion">Accordion</option>
							<option value="acoustic_guitar_nylon">Nylon Guitar</option>
							<option value="acoustic_guitar_steel">Steel Guitar</option>
						</optgroup>
					</select>
					<label style="margin-bottom: 2px; font-size: 12px;">Chord Volume</label>
					<div style="display: flex; align-items: center; margin-bottom: 6px;">
						<span style="font-size: 14px; margin-right: 4px; cursor: pointer;" id="chord-mute"
							title="Mute">🔇</span>
						<input type="range" id="chord-volume" min="0" max="1.15" step="0.05" value="0.5"
							style="width:100px;">
						<span style="font-size: 14px; margin-left: 4px; cursor: pointer;" id="chord-boost"
							title="Boost +15%">🔊</span>
					</div>
					<!-- Play Buttons - Exact match to Play Bass/Melody styling -->
					<button id="play-chords"
						style="width:120px; padding:4px; margin-top:4px; background:#333; color:#fff; border:1px solid #555; border-radius:4px; cursor:pointer;">▶
						Play Chords</button>
					<button id="play-progression-main"
						style="width:120px; padding:4px; margin-top:4px; background:#333; color:#fff; border:1px solid #555; border-radius:4px; cursor:pointer;">▶
						Play Progression</button>
					<!-- PHASE 1 TASK 1B: RED STOP BUTTON -->
					<button id="emergency-stop-btn"
						style="width:120px; padding:4px; margin-top:4px; background:#cc0000; color:#fff; border:1px solid #aa0000; border-radius:4px; cursor:pointer; font-weight:bold; box-shadow:0 2px 4px rgba(204,0,0,0.5);">🛑
						STOP</button>
				</div>

				<!-- Melody Column -->
				<div style="display: flex; flex-direction: column; align-items: flex-start;">
					<label style="margin-bottom: 2px; font-size: 12px;">Melody Instrument</label>
					<select id="melody-inst" style="width: 120px; margin-bottom: 6px;">
						<option value="violin" selected>Violin</option>
						<option value="viola">Viola</option>
						<option value="cello">Cello</option>
						<option value="flute">Flute</option>
						<option value="clarinet">Clarinet</option>
						<option value="oboe">Oboe</option>
						<option value="bassoon">Bassoon</option>
						<option value="alto_sax">Alto Sax</option>
						<option value="tenor_sax">Tenor Sax</option>
						<option value="trumpet">Trumpet</option>
						<option value="trombone">Trombone</option>
						<option value="french_horn">French Horn</option>
						<option value="orchestral_harp">Orchestral Harp</option>
						<option value="marimba">Marimba</option>
						<option value="xylophone">Xylophone</option>
						<option value="vibraphone">Vibraphone</option>
						<option value="acoustic_guitar_nylon">Nylon Guitar</option>
						<option value="acoustic_guitar_steel">Steel Guitar</option>
						<option value="voice_oohs">Voice Oohs</option>
						<option value="synth_voice">Synth Voice</option>
						<option value="sitar">Sitar</option>
						<option value="banjo">Banjo</option>
					</select>
					<label style="margin-bottom: 2px; font-size: 12px;">Melody Volume</label>
					<div style="display: flex; align-items: center; margin-bottom: 6px;">
						<span style="font-size: 14px; margin-right: 4px; cursor: pointer;" id="melody-mute"
							title="Mute">🔇</span>
						<input type="range" id="melody-volume" min="0" max="1.15" step="0.05" value="0"
							style="width:100px;">
						<span style="font-size: 14px; margin-left: 4px; cursor: pointer;" id="melody-boost"
							title="Boost +15%">🔊</span>
					</div>
					<button id="lock-melody"
						style="width:120px; padding:4px; background:#333; color:#fff; border:1px solid #555; border-radius:4px; cursor:pointer;">Lock
						Melody</button>
					<button id="play-melody"
						style="width:120px; padding:4px; margin-top:4px; background:#333; color:#fff; border:1px solid #555; border-radius:4px; cursor:pointer;">▶
						Play Melody</button>
				</div>
			</div>


			<label style="margin-left:12px;">Voice Leading</label>
			<select id="voice-leading-mode">
				<option value="vl1">Voice leading 1 (Nearest Octave)</option>
				<option value="vl2">Voice leading 2 (Minimal Distance)</option>
				<option value="vl3" selected>Voice leading 3 (Academic Grade)</option>
			</select>
			<button id="play-progression" style="margin-left:12px;">Play Progression</button>
			<label style="margin-left:8px;">Loops:</label>
			<input type="number" id="progression-loops" min="1" max="99" value="1" style="width:50px; margin-left:4px;">
			<label style="margin-left:12px;">
				<input type="checkbox" id="progression-arrows" /> Arrows
			</label>
			<input type="number" id="max-arrows" min="1" max="50" value="20" style="width:40px; margin-left:4px;"
				title="Max arrows before oldest disappears">
			<button id="font-control-btn"
				style="margin-left:12px; background:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:3px;">Font
				Controls</button>
		</div>
		<div class="row small">
			<span>Tip: Click center of chord face to replay; non-label faces audition single notes.</span>
		</div>

		<!-- Musical Staves 3D Controls -->
		<div class="row small" id="musical-staves-controls"
			style="margin-top:10px; padding:10px; background:rgba(0,150,136,0.1); border-radius:5px;">
			<label style="color:#009688; font-weight:bold; margin-right:12px;">🎼 3D Musical Staves:</label>
			<button id="show-staves"
				style="background:#4CAF50; color:white; padding:6px 12px; border:none; border-radius:4px; margin-right:8px; cursor:pointer;">Show
				Staves</button>
			<button id="hide-staves"
				style="background:#f44336; color:white; padding:6px 12px; border:none; border-radius:4px; margin-right:8px; cursor:pointer;">Hide
				Staves</button>
			<button id="test-progression"
				style="background:#2196F3; color:white; padding:6px 12px; border:none; border-radius:4px; cursor:pointer;">Test
				3-Voice Notes</button>
		</div>
	</div>
	<canvas id="scene"></canvas>
	<!-- legacy lane-controls removed; lock icons integrated into camera-ui -->
	<div class="adjust-hint">Adjust mode: drag shelf cubes; scroll to scale; Save Map to download JSON.</div>

	<div id="camera-ui">
		<button id="view-down" title="Melody View">Melody View</button>
		<button id="view-up" title="Bass View">Bass View</button>
		<button id="view-back" title="Back View">Back View</button>
	</div>

	<!-- Professional Drum Control Panel -->
	<div id="drum-control-panel">
		<div class="panel-header">
			<h2 class="panel-title">
				<span id="improv-mode-free"
					style="cursor: pointer; margin-right: 8px; opacity: 1; font-size: 18px; transition: all 0.3s ease; transform: scale(1.2);"
					title="Free Improv: Root position only">🎵</span>
				V1.50
				<span id="improv-mode-creation"
					style="cursor: pointer; margin-left: 8px; opacity: 0.4; font-size: 18px; transition: all 0.3s ease; transform: scale(1);"
					title="Creation Improv: Full inversions + front row">🎼</span>
			</h2>
			<span id="drum-play-progression"
				style="cursor: pointer; margin-left: 12px; margin-right: 8px; font-size: 20px; opacity: 1.0; transition: all 0.2s ease; color: #00ff00; text-shadow: 0 0 4px rgba(0,255,0,0.5); background: rgba(0,255,0,0.1); padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(0,255,0,0.3);"
				title="Play Progression">▶</span>
			<span id="drum-stop-progression"
				style="cursor: pointer; margin-right: 8px; font-size: 20px; opacity: 1.0; transition: all 0.2s ease; color: #ff0000; text-shadow: 0 0 4px rgba(255,0,0,0.5); background: rgba(255,0,0,0.1); padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(255,0,0,0.3);"
				title="Stop Progression">⏹</span>
			<div class="status-indicator" id="status-light"></div>
		</div>

		<!-- BPM Control -->
		<div class="control-group">
			<label class="control-label">Tempo Control</label>
			<div class="bpm-control">
				<input type="range" class="bpm-slider" id="bpm-slider" min="60" max="200" value="100">
				<div class="bpm-display" id="bpm-display">100</div>
			</div>
		</div>

		<!-- Drum Volume Control -->
		<div class="control-group">
			<label class="control-label">Drum Volume</label>
			<div class="bmp-control">
				<input type="range" class="bpm-slider" id="drum-volume-slider" min="0" max="1" step="0.1" value="0.5">
				<div class="bpm-display" id="drum-volume-display">50%</div>
			</div>
		</div>

		<!-- Genre Selector -->
		<div class="control-group">
			<label class="control-label">Music Style</label>
			<div class="genre-grid">
				<button class="genre-btn active" data-genre="rock">Rock</button>
				<button class="genre-btn" data-genre="hiphop">Hip-Hop</button>
				<button class="genre-btn" data-genre="electronic">Electronic</button>
				<button class="genre-btn" data-genre="jazz">Jazz</button>
				<button class="genre-btn" data-genre="latin">Latin</button>
				<button class="genre-btn" data-genre="funk">Funk</button>
				<button class="genre-btn" data-genre="country">Country</button>
				<button class="genre-btn" data-genre="orchestral">Orchestra</button>
				<button class="genre-btn" data-genre="trap">Trap</button>
			</div>
		</div>

		<!-- Main Controls -->
		<div class="main-controls">
			<button class="control-btn play-btn" id="drum-toggle">▶ DRUMS OFF</button>
			<button class="control-btn metronome-btn" id="metronome-toggle">🔔 CLICK OFF</button>
		</div>

		<!-- Pattern Sequencer -->
		<div class="sequencer" id="sequencer">
			<div class="sequencer-row">
				<div class="sequencer-label">KICK</div>
				<div class="sequencer-steps" id="kick-steps"></div>
			</div>
			<div class="sequencer-row">
				<div class="sequencer-label">SNARE</div>
				<div class="sequencer-steps" id="snare-steps"></div>
			</div>
			<div class="sequencer-row">
				<div class="sequencer-label">HI-HAT</div>
				<div class="sequencer-steps" id="hihat-steps"></div>
			</div>
		</div>

		<!-- Status Display -->
		<div class="status-display">
			<div class="status-line">
				<span class="status-label">Audio:</span>
				<span class="status-value" id="audio-status">Initializing...</span>
			</div>
			<div class="status-line">
				<span class="status-label">Transport:</span>
				<span class="status-value" id="transport-status">Ready</span>
			</div>
			<div class="status-line">
				<span class="status-label">Kit Loaded:</span>
				<span class="status-value" id="kit-status">Rock</span>
			</div>
			<div class="status-line">
				<span class="status-label">CPU:</span>
				<span class="status-value" id="cpu-status">0%</span>
			</div>
		</div>
	</div>

	<script type="importmap">
	{
		"imports": {
			"three": "https://unpkg.com/three@0.160.0/build/three.module.js",
			"three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
		}
	}
	</script>
	<!-- Tone.js for audio engine aligned with Novaxe stack -->
	<script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
	<!-- WebAudioFont for realistic orchestral samples -->
	<script src='https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js'></script>
	<!-- WORKING REAL SAMPLES: Tonejs-Instruments Library -->
	<script src="https://nbrosowsky.github.io/tonejs-instruments/Tonejs-Instruments.js"></script>
	<!-- Tonal for voice-leading utilities (mode 2) -->
	<script src="https://cdn.jsdelivr.net/npm/@tonaljs/tonal@4.12.1/build/tonal.min.js"></script>
	<!-- VexFlow for musical notation -->
	<script src="https://unpkg.com/vexflow@4.2.2/build/cjs/vexflow.js"></script>
	<script src="./musical-staves-3d.js"></script>
	<script src="./staves-integration.js"></script>
	<script type="module" src="./chords.js?v=4"></script>
	<script type="module" src="./instrumentManager.js"></script>
	<script type="module" src="./main.js?v=1049"></script>
	<!-- OLD PROFESSIONAL-DRUM-MACHINE.JS REMOVED - CONFLICTS WITH MAIN.JS -->

	<!-- PROFESSIONAL FONT CONTROL MODAL -->
	<div id="font-control-modal"
		style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; overflow-y:auto;">
		<div
			style="background:white; margin:50px auto; padding:30px; width:80%; max-width:800px; border-radius:10px; box-shadow:0 4px 20px rgba(0,0,0,0.3);">
			<div
				style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:15px;">
				<h2 style="margin:0; color:#333; font-family:Arial,sans-serif;">🎨 Professional Font Controls</h2>
				<button id="font-modal-close"
					style="background:#f44336; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; font-size:16px;">✕</button>
			</div>

			<!-- Font Target Selection -->
			<div style="margin-bottom:25px;">
				<label style="display:block; margin-bottom:10px; font-weight:bold; color:#333;">Select Font
					Target:</label>
				<select id="font-target-select"
					style="width:100%; padding:10px; font-size:16px; border:2px solid #ddd; border-radius:5px;">
					<option value="chord-face">Chord Face Font (Roman Numerals)</option>
					<option value="diamond-font">Diamond Font (Note Names)</option>
					<option value="title-font">Title Font (MELODY/BASSLINE)</option>
					<option value="ui-font">UI Font (Buttons/Labels)</option>
				</select>
			</div>

			<!-- InDesign-Level Controls -->
			<div id="font-controls-container">

				<!-- Font Family -->
				<div style="display:flex; gap:20px; margin-bottom:20px;">
					<div style="flex:1;">
						<label style="display:block; margin-bottom:5px; font-weight:bold;">Font Family:</label>
						<select id="font-family-select"
							style="width:100%; padding:8px; border:1px solid #ccc; border-radius:3px;">
							<option value="Arial">Arial</option>
							<option value="Times New Roman">Times New Roman</option>
							<option value="Helvetica">Helvetica</option>
							<option value="Georgia">Georgia</option>
							<option value="Verdana">Verdana</option>
							<option value="Trebuchet MS">Trebuchet MS</option>
							<option value="Impact">Impact</option>
							<option value="Courier New">Courier New</option>
							<option value="Comic Sans MS">Comic Sans MS</option>
							<option value="Palatino">Palatino</option>
						</select>
					</div>
					<div style="flex:1;">
						<label style="display:block; margin-bottom:5px; font-weight:bold;">Font Weight:</label>
						<select id="font-weight-select"
							style="width:100%; padding:8px; border:1px solid #ccc; border-radius:3px;">
							<option value="100">Thin (100)</option>
							<option value="200">Extra Light (200)</option>
							<option value="300">Light (300)</option>
							<option value="400">Normal (400)</option>
							<option value="500">Medium (500)</option>
							<option value="600">Semi Bold (600)</option>
							<option value="700">Bold (700)</option>
							<option value="800">Extra Bold (800)</option>
							<option value="900" selected>Black (900)</option>
						</select>
					</div>
				</div>

				<!-- Font Size and Spacing -->
				<div style="display:flex; gap:20px; margin-bottom:20px;">
					<div style="flex:1;">
						<label style="display:block; margin-bottom:5px; font-weight:bold;">Font Size:</label>
						<input type="range" id="font-size-slider" min="50" max="800" value="420" style="width:100%;">
						<span id="font-size-value"
							style="display:block; text-align:center; margin-top:5px; font-weight:bold;">420px</span>
					</div>
					<div style="flex:1;">
						<label style="display:block; margin-bottom:5px; font-weight:bold;">Letter Spacing:</label>
						<input type="range" id="letter-spacing-slider" min="-20" max="50" value="0" style="width:100%;">
						<span id="letter-spacing-value"
							style="display:block; text-align:center; margin-top:5px; font-weight:bold;">0px</span>
					</div>
				</div>

				<!-- Line Height and Opacity -->
				<div style="display:flex; gap:20px; margin-bottom:20px;">
					<div style="flex:1;">
						<label style="display:block; margin-bottom:5px; font-weight:bold;">Line Height:</label>
						<input type="range" id="line-height-slider" min="0.5" max="2.0" step="0.05" value="0.68"
							style="width:100%;">
						<span id="line-height-value"
							style="display:block; text-align:center; margin-top:5px; font-weight:bold;">0.68</span>
					</div>
					<div style="flex:1;">
						<label style="display:block; margin-bottom:5px; font-weight:bold;">Opacity:</label>
						<input type="range" id="opacity-slider" min="0" max="1" step="0.05" value="1.0"
							style="width:100%;">
						<span id="opacity-value"
							style="display:block; text-align:center; margin-top:5px; font-weight:bold;">100%</span>
					</div>
				</div>

				<!-- Text Effects -->
				<div style="display:flex; gap:20px; margin-bottom:20px;">
					<div style="flex:1;">
						<label style="display:block; margin-bottom:10px; font-weight:bold;">Text Effects:</label>
						<div style="display:flex; gap:10px; flex-wrap:wrap;">
							<label style="display:flex; align-items:center; gap:5px;">
								<input type="checkbox" id="font-italic"> Italic
							</label>
							<label style="display:flex; align-items:center; gap:5px;">
								<input type="checkbox" id="font-underline"> Underline
							</label>
							<label style="display:flex; align-items:center; gap:5px;">
								<input type="checkbox" id="font-shadow"> Drop Shadow
							</label>
						</div>
					</div>
				</div>

				<!-- 3D Cube Preview -->
				<div
					style="margin-bottom:20px; padding:20px; background:#f9f9f9; border-radius:5px; border:2px solid #eee;">
					<label style="display:block; margin-bottom:10px; font-weight:bold;">3D Live Preview:</label>
					<div style="display: flex; align-items: center; gap: 15px;">
						<div id="font-preview-3d"
							style="width: 200px; height: 200px; background: #222; border-radius: 8px; border: 1px solid #444;">
						</div>
						<div style="display: flex; flex-direction: column; gap: 8px;">
							<button id="rotate-up"
								style="padding: 8px 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">↑
								Rotate Up</button>
							<button id="rotate-down"
								style="padding: 8px 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">↓
								Rotate Down</button>
							<button id="rotate-left"
								style="padding: 8px 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">←
								Rotate Left</button>
							<button id="rotate-right"
								style="padding: 8px 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">→
								Rotate Right</button>
							<button id="auto-rotate"
								style="padding: 8px 12px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer;">🔄
								Auto Rotate</button>
						</div>
					</div>
				</div>

				<!-- Action Buttons -->
				<div style="display:flex; gap:15px; justify-content:center;">
					<button id="font-apply-btn"
						style="background:#4CAF50; color:white; border:none; padding:12px 25px; border-radius:5px; cursor:pointer; font-size:16px; font-weight:bold;">Apply
						Changes</button>
					<button id="font-reset-btn"
						style="background:#ff9800; color:white; border:none; padding:12px 25px; border-radius:5px; cursor:pointer; font-size:16px; font-weight:bold;">Reset
						to Default</button>
					<button id="font-cancel-btn"
						style="background:#757575; color:white; border:none; padding:12px 25px; border-radius:5px; cursor:pointer; font-size:16px; font-weight:bold;">Cancel</button>
				</div>
			</div>
		</div>
	</div>

	<!-- � COMPREHENSIVE PIPELINE TRACER 🔥 -->
	<div id="pipelineTracer" style="
		position: fixed;
		bottom: 10px;
		left: 10px;
		right: 10px;
		background: rgba(0,20,0,0.95);
		border: 2px solid #00ff00;
		border-radius: 10px;
		padding: 15px;
		font-family: 'Courier New', monospace;
		color: #00ff00;
		z-index: 10000;
		box-shadow: 0 0 20px rgba(0,255,0,0.3);
	">
		<div style="text-align: center; font-size: 16px; font-weight: bold; margin-bottom: 10px;">
			🔥 KEYBOARD → CUBE FACE PIPELINE TRACER 🔥
		</div>
		<div id="pipelineStages" style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;">
			<!-- Pipeline stages will be inserted here -->
		</div>
		<div id="pipelineStatus" style="text-align: center; margin-top: 10px; font-size: 14px;">
			Status: Waiting for keypress...
		</div>
	</div>

	<!-- �🔬 FORENSIC DEBUGGING WIDGET - ULTRA OPTIMIZED -->
	<div id="debug-widget" class="debug-panel">
		<div class="debug-title">🔬 FORENSIC KEYBOARD DEBUGGER</div>
		<div class="debug-keyboard">
			<div class="debug-row">
				<span class="debug-key" id="debug-shift">SHIFT</span>
				<span class="debug-key" id="debug-option">OPTION</span>
				<span class="debug-key" id="debug-ctrl">CTRL</span>
			</div>
			<div class="debug-row">
				<span class="debug-key" id="debug-1">1</span>
				<span class="debug-key" id="debug-2">2</span>
				<span class="debug-key" id="debug-9">9</span>
			</div>
		</div>
		<div class="debug-cube-container">
			<canvas id="debug-cube-face" width="80" height="80"></canvas>
			<div class="debug-cube-label">CHORD X</div>
		</div>
		<div class="debug-status" id="debug-status">Ready...</div>
	</div>

</body>

</html>